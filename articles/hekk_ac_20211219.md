---
title: "ã€ã‚ã‚“ã•ã‚“ã¶ã‚‹ã‚¹ã‚¿ãƒ¼ã‚ºï¼ï¼ Musicã€ã«ãŠã‘ã‚‹ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®å°å…¥"
emoji: "ğŸ—“"
type: "idea" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["ã‚½ãƒ¼ã‚·ãƒ£ãƒ«ã‚²ãƒ¼ãƒ ", "AWS", "GoogleCalendar", "ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°"]
publication_name: "happy_elements"
published: true
published_at: 2021-12-19 12:00
---

ã“ã‚“ã«ã¡ã¯ã€HappyElements æ ªå¼ä¼šç¤¾ã§ã‚¤ãƒ³ãƒ•ãƒ©é‹ç”¨ã‚’æ‹…å½“ã—ã¦ã„ã‚‹N.Sã§ã™ã€‚
æœ¬è¨˜äº‹ã§ã¯ã€ã‚ã‚“ã•ã‚“ã¶ã‚‹ã‚¹ã‚¿ãƒ¼ã‚ºï¼ï¼ Music æ—¥ã€…ã®é‹ç”¨ã¾ã‚ã‚Šã§ã®æ”¹å–„ã«ã¤ã„ã¦ç´¹ä»‹ã—ã¾ã™ã€‚

ã‚ã‚“ã•ã‚“ã¶ã‚‹ã‚¹ã‚¿ãƒ¼ã‚ºï¼ï¼ Music ã®AWSæ§‹æˆã«ã¤ã„ã¦ã¯ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://aws.amazon.com/jp/solutions/case-studies/happyelements/

# ã€‡è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°é‹ç”¨ã«ã¤ã„ã¦
AWS Auto Scaling ã«ã¯è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹æ©Ÿèƒ½ãŒä»˜ã„ã¦ã¾ã™ã€‚

## ã‚ªãƒ¼ãƒˆã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
ï¼ˆCPUä½¿ç”¨ç‡ãƒ»ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ï¼‰ãŒé–¾å€¤ã«ãªã‚‹ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã‚’å¢—ã‚„ã™ã€‚ã¨ã„ã†ã‚‚ã®
![](https://storage.googleapis.com/zenn-user-upload/32a5e9845a28-20230313.png)

## ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
æŒ‡å®šæ—¥æ™‚ã«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ•°ã‚’è¨­å®šã™ã‚‹ã€‚ã¨ã„ã†ã‚‚ã®
![](https://storage.googleapis.com/zenn-user-upload/f6a0e91b9f44-20230313.png)

ã“ã‚Œã‚‰ã‚’é§†ä½¿ã—ã¦ã€å®‰å®šé‹ç”¨ã«ãªã‚‹ã‹ã¨æ€ã£ã¦ã„ãŸã®ã§ã™ãŒ...

# ã€‡é‹ç”¨ä¸­ã®å›°ã‚Šã”ã¨

- å›½æ°‘ã®ä¼‘æ—¥ï¼ˆåœŸæ—¥ç¥ï¼‰ã§ã¯ã€å¹³æ—¥ã«æ¯”ã¹ã¦ã‚¢ã‚¯ã‚»ã‚¹é‡ãŒå¤šã„ã€‚
é«˜è² è·çŠ¶æ…‹ã®é€šçŸ¥ãŒé »ç™ºã—ã¦ã—ã¾ã†ãŸã‚ã€ç§çš„ã«ã¯å¿ƒãŒä¼‘ã¾ã‚‰ãªã„ã€‚

- ã‚¢ã‚¤ãƒ‰ãƒ«ã®èª•ç”Ÿæ—¥ã¯è‰²ã€…ãªç‰¹å…¸ãŒã‚ã£ã¦å¹³æ—¥ã«æ¯”ã¹ã¦ã‚¢ã‚¯ã‚»ã‚¹é‡ãŒå¤šã„ã€‚
ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãŒã‚ã‚‹ã®ã§ã¯ï¼Ÿã¨æ€ã‚ã‚Œã¾ã™ãŒã€ç™»éŒ²æ•°ãŒå¤šããªã‚‹ã¨çŠ¶æ³ãŒåˆ†ã‹ã‚Šã¥ã‚‰ããªã‚Šã¾ã™ã€‚

## è¦ä»¶
- åœŸæ—¥ç¥ã€ã‚¢ãƒ—ãƒªç‰¹æœ‰ã®æ—¥ã¯ãƒªã‚½ãƒ¼ã‚¹ã‚’é©åˆ‡ã«å¢—åŠ ã•ã›ãŸã„ã€‚
- è¦‹ã‚„ã™ã„ã€ã‚ã‹ã‚Šã‚„ã™ã„æ§˜ã«ç®¡ç†ã—ãŸã„ã€‚ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ï¼‰

# ã€‡è§£æ±ºç­–
ã“ã¡ã‚‰ã®è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦é ‚ãã¾ã—ãŸã€‚
[AWS Systems Manager Change Calendarã§ç¥æ—¥ã‚’è¨­å®šã—ãŸã‚¸ãƒ§ãƒ–å®Ÿè¡ŒãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸ](https://dev.classmethod.jp/articles/ssm-change-calendar-import-holiday/)
â–¼ã‚¤ãƒ¡ãƒ¼ã‚¸å›³
![](https://storage.googleapis.com/zenn-user-upload/5f8dd6641f7f-20230313.png)

## æ‰‹é †ï¼‘. Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç·¨
1. Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã„ã¦ã€è¨­å®šï¼ˆæ­¯è»Šï¼‰
![](https://storage.googleapis.com/zenn-user-upload/7aa560520091-20230313.png)

2. æ–°ã—ã„ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ä½œæˆã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/842bee94763c-20230313.png)

3. å†åº¦ã€Googleã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®è¨­å®šã‹ã‚‰ã€æ—¥æœ¬ã®ç¥æ—¥ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/dfe3ddbc3548-20230313.png)

4. æ—¥æœ¬ã®ç¥æ—¥ã‚’é¸æŠã—ã€iCal å½¢å¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/70c246bf46fe-20230313.png)

5. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚­ã‚¹ãƒˆã§é–‹ã X-WR-TIMEZONE ã®å€¤ã‚’ Asia/Tokyo ã«å¤‰æ›´ã—ã¦ä¿å­˜ã€‚
```
BEGIN:VCALENDAR
PRODID:-//Google Inc//Google Calendar 70.9054//EN
VERSION:2.0
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:æ—¥æœ¬ã®ç¥æ—¥
X-WR-TIMEZONE:UTC -> Asia/Tokyo
ã€€ï¼šï¼ˆçœç•¥ï¼‰
```

6. æ–°è¦ä½œæˆã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«æ—¥æœ¬ã®ç¥æ—¥iCalã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/e2e5de17a4a9-20230313.png)

7. ãã®ä»–ã€æ–°è¦ä½œæˆã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã«äºˆå®šã‚’ç™»éŒ²ã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/786878aa2ba7-20230313.png)

8. æ–°è¦ä½œæˆã—ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/44df261454af-20230313.png)
â€»zipãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã£ã¦ã„ã‚‹ã®ã§ã€ä½¿ã†ã¨ãã¯è§£å‡ãŒå¿…è¦

## æ‰‹é †ï¼’. AWS Systems Manager Change Calendarç·¨
1. AWSã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‹ã‚‰ã€Systems Manager ï¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’å¤‰æ›´ ï¼ ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ä½œæˆ ã§ã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã€DEFAULT_OPENã®ã¾ã¾ã€Œã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’ä½œæˆã€
![](https://storage.googleapis.com/zenn-user-upload/79bbe7b518ad-20230313.png)

2. èª¬æ˜ï¼ˆã‚¿ãƒ–ï¼‰ ï¼ Calender useï¼ˆâ–¼ï¼‰ ï¼ AWS CLIï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã€‚
![](https://storage.googleapis.com/zenn-user-upload/1e7f99f6826f-20230313.png)

## æ‰‹é †ï¼“. å®Ÿè¡Œæ–¹æ³•ã«ã¤ã„ã¦
äºˆå®šãŒå…¥ã£ã¦ã„ã‚‹åˆ†ã«é–¢ã—ã¦ã¯ã€CLOSEãŒè¿”ã£ã¦ãã‚‹ã€‚æœªäºˆå®šéƒ¨åˆ†ã¯OPENã¨ãªã‚‹ã®ã§ç¢ºèªã—ã¾ã™ã€‚

1. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§è¨­å®šã—ã¦ã„ã‚‹æ—¥æœ¬ã®ç¥æ—¥ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ãŸå ´åˆ
```11/23(ç¥æ—¥)
$ aws ssm get-calendar-state --calendar-names arn:aws:ssm:ap-northeast-1:1234567890:document/AWS2DAY --region ap-northeast-1 --at-time "2021-11-23T00:00:00+09:00" --query 'State' --output text
CLOSED
```

2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§è¨­å®šã—ã¦ã„ã‚‹å¹³æ—¥ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ãŸå ´åˆ
```11/24(æ°´)
$ aws ssm get-calendar-state --calendar-names arn:aws:ssm:ap-northeast-1:1234567890:document/AWS2DAY --region ap-northeast-1 --at-time "2021-11-24T00:00:00+09:00" --query 'State' --output text
OPEN
```


3. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã¯åˆ©ç”¨ã›ãšã€cronã§Lambdaã‚’å®Ÿè¡Œã™ã‚‹å‡¦ç†ã«å¤‰æ›´ã—ã¾ã™ã€‚
- AWS ç®¡ç†ãƒãƒªã‚·ãƒ¼ã€AmazonSSMReadOnlyAccessã€ã‚’ä»˜ã‘ã‚‹ã€‚
```python
import boto3
from datetime import datetime, timedelta, timezone

ssm = boto3.client('ssm')

def lambda_handler(event, context):
    try:
        # holidays
        JST = timezone(timedelta(hours=+9), 'JST')
        nowtime = datetime.now(JST).isoformat(timespec="seconds")
        print(nowtime)
        response = ssm.get_calendar_state(
            CalendarNames=[
                'AWS2DAY',
            ],
            AtTime=nowtime
        )
        print(response['State'])
        if response['State'] == 'CLOSED':
            print("ä¼‘æ—¥orèª•ç”Ÿæ—¥ãªç‚ºã€ãƒªã‚½ãƒ¼ã‚¹ã‚’é€šå¸¸ã‚ˆã‚Šå¤šãã™ã‚‹å‡¦ç†")

    except Exception as e:
        print(e)
```
CLOSEæ™‚ã¯ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§è¨­å®šã—ãŸåœŸæ—¥ç¥ãƒ»ã‚¢ãƒ—ãƒªç‰¹æœ‰ã®æ—¥ã®ç‚ºã€ã“ã“ã§ãƒªã‚½ãƒ¼ã‚¹ã®èª¿æ•´ã‚’è¡Œã„ã¾ã™ã€‚

# ã€‡ã¾ã¨ã‚
AWS Systems Manager Change Calendarã¨Lambdaã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€éå¸¸ã«ç°¡å˜ã«ã€æ—¥æœ¬ã®ç¥æ—¥ãƒ»åœŸæ—¥ã€ã€ã‚¢ãƒ—ãƒªç‰¹æœ‰ã®æ—¥ã€ã®å¯¾å¿œãŒã§ãã¾ã—ãŸâ™ª
